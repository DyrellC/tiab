apiVersion: v1
kind: Pod
metadata:
  name: iri-tanglescope-REVISION_PLACEHOLDER-NODE_NUMBER_PLACEHOLDER
  labels:
    app: iri
    nodenum: "NODE_NUMBER_PLACEHOLDER"
    full: ISFULL_PLACEHOLDER
    revision: REVISION_PLACEHOLDER
spec:
  containers:

  - name: iri
    image: IRI_IMAGE_PLACEHOLDER
    imagePullPolicy: Always
    args:
    - "--port"
    - "API_PORT_PLACEHOLDER"
    - "--tcp-receiver-port"
    - "GOSSIP_TCP_PORT_PLACEHOLDER"
    - "--udp-receiver-port"
    - "GOSSIP_UDP_PORT_PLACEHOLDER"
    - "--testnet"
    - "--testnet-coordinator"
    - "BTCAAFIH9CJIVIMWFMIHKFNWRTLJRKSTMRCVRE9CIP9AEDTOULVFRHQZT9QAQBZXXAZGBNMVOOKTKAXTB"
    - "--testnet-no-coo-validation"
    - "--milestone-start"
    - "0"
    - "--snapshot"
    - "/iri/data/snapshot.txt"
    env:
    - name: IRI_DB_URL
      value: IRI_DB_URL_PLACEHOLDER
    ports:
    # IRI API
    - containerPort: API_PORT_PLACEHOLDER
    # IRI Gossip
    - containerPort: GOSSIP_TCP_PORT_PLACEHOLDER
    - containerPort: GOSSIP_UDP_PORT_PLACEHOLDER
      protocol: UDP
    # JMX Prometheus
    - containerPort: 5555
    # ZMQ Feed
    - containerPort: 5556
    # JProfiler
    - containerPort: 8849

  - name: tanglescope
    image: iotacafe/entangled:tanglescope-41fa5ab-1
    volumeMounts:
      - name: tanglescope
        subPath: tanglescope.yml
        mountPath: /config.yml
    ports:
    # Exporter
    - containerPort: 4444
    - containerPort: 4445
    - containerPort: 4446
    - containerPort: 4447

  volumes:
    - name: tanglescope
      configMap:
        name: tanglescope-REVISION_PLACEHOLDER

---
apiVersion: v1
kind: Service
metadata:
  name: iri-REVISION_PLACEHOLDER-NODE_NUMBER_PLACEHOLDER
  labels:
    app: iri
    nodenum: "NODE_NUMBER_PLACEHOLDER"
    full: ISFULL_PLACEHOLDER
    revision: REVISION_PLACEHOLDER

spec:
  ports:
    - name: api
      port: API_PORT_PLACEHOLDER
      targetPort: API_PORT_PLACEHOLDER
    - name: jprofiler
      port: 8849
      targetPort: 8849
  selector:
    app: iri
    nodenum: "NODE_NUMBER_PLACEHOLDER"
    full: ISFULL_PLACEHOLDER
    revision: REVISION_PLACEHOLDER
  type: LoadBalancer
